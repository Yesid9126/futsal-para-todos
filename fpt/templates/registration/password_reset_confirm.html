{% extends "users/base.html" %}
{% load static i18n static %}
{% block title %}{% trans "Cambio contraseña" %}{% endblock %}
{% block css %}

{% endblock css %}
{% block container %}
<form method="post">
  {% csrf_token %}
  <main class="flex-shrink-0 pt-0 h-100">
    <div class="container-fluid">
      <div class="auth-wrapper d-flex flex-column minvheight-100">
        <header class="adminuiux-header">
          <nav class="navbar navbar-expand-lg fixed-top">
            <div class="container-fluid"><button class="btn btn-square btn-link" onclick="goBack()"><i
                  class="bi bi-arrow-left"></i></button>
              <div class="ms-auto"><a href="/" class="btn btn-link">Iniciar sesión</a></div>
            </div>
          </nav>
        </header>
        {% if not validlink %}
        <div class="row align-items-center justify-content-center py-4 mt-auto">
          <div class="col-11 col-sm-8 col-md-11 col-xl-11 col-xxl-10 login-box">
            <div class="mb-4">
              <h2 class="text-theme-accent-1 mb-0">{{request.user.first_name|title}}</h2>
              <h1 class="fw-bold text-theme-1">Este link expiró</h1>
              <p class="text-secondary">Solcita una nuevo acá
                <a href="{% url 'password_reset' %}" class="text-theme-accent-1">Recuperar contraseña</a>
              </p>
            </div>



          </div>
        </div>
        {% else %}
        <form action="" method="post">
          {% csrf_token %}
        <div class="row align-items-center justify-content-center py-4 mt-auto">
          <div class="col-xl-6 col-lg-7 col-md-10 contact-form-style-04 md-mb-50px section-login">
            <div class="mb-4">
              <h2 class="text-theme-accent-1 mb-0">{{request.user.first_name|title}}</h2>
              <span class="fs-26 xs-fs-24 alt-font fw-600 text-dark-gray mb-20px d-block">Cambio de contraseña</span>
              <p class="text-secondary">Configura tu nueva contraseña</p>
            </div>
            <div class="position-relative">
              <label for="checkstrength">Nueva contaseña</label>
              <div class="form-floating mb-3">
                <input type="password" name="new_password1"
                class="mb-20px bg-very-light-gray form-control {%if form.new_password1.errors or form.new_password2.errors %}is-invalid{%endif%}"
                placeholder="Nueva contraseña" id='new_password'>
                <div class="invalid-feedback text-left">
                  {% for error in form.new_password1.errors %}
                    {{error}}
                  {% endfor %}
                </div>
                <button type="button" class="btn btn-square btn-link text-theme-1 position-absolute end-0 top-0 mt-2 me-8"><i
                  class="bi bi-eye"></i>
                </button>
              </div>
            </div>
            <div class="position-relative">
              <label for="passwdconfirm">Confirmar contraseña</label>
              <div class="form-floating mb-4">
                <input type="password" name="new_password2" class="mb-20px bg-very-light-gray form-control {%if form.new_password2.errors %}is-invalid{%endif%}"
                placeholder="Confirmar nueva contraseña"> 
                  <div class="invalid-feedback text-left">
                    {% for error in form.new_password2.errors %}
                    {{error}}
                    {% endfor %}
                  </div>
                  <button type="button" class="btn btn-square btn-link text-theme-1 position-absolute end-0 top-0 mt-2 me-8"><i
                    class="bi bi-eye"></i>
                  </button>
              </div>
            </div>
            <button class="btn btn-medium btn-round-edge btn-base-color btn-box-shadow w-100" type="submit">Cambiar contraseña</button><br>
          </div>
        </div>
        {% endif %}

      </form>
      <footer>
        <div class="container-fluid text-center">
          <span class="small">Copyright @2025, <a target="_blank">Futsal para todos</a>❤️</span>
        </div>
      </footer>
      </div>
    </div>
  </main>
</form>

{% endblock %}

{% block js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleButtons = document.querySelectorAll(".btn-square i");

    toggleButtons.forEach((icon) => {
      icon.addEventListener("click", function (e) {
        e.preventDefault(); // Evita que el botón envíe el formulario

        const input = icon.closest(".position-relative").querySelector("input");
        const isPassword = input.getAttribute("type") === "password";
        input.setAttribute("type", isPassword ? "text" : "password");

        // Cambiar ícono
        icon.classList.toggle("bi-eye");
        icon.classList.toggle("bi-eye-slash");
      });
    });
  });
</script>
<script>document.addEventListener("DOMContentLoaded", (function () { $("#title").length > 0 && $(".title").html($("#title").html()) }))</script>
{% endblock js %}
