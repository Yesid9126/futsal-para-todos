{% extends "base.html" %}

{% load static %}
{% load humanize %}

{% block title %}Futsal para todos{% endblock %}

{% block content %}

<section class="top-space-margin border-top border-color-extra-medium-gray pt-20px pb-20px ps-45px pe-45px lg-ps-35px lg-pe-35px md-ps-15px md-pe-15px sm-ps-0 sm-pe-0">
    <div class="container-fluid">
        <div class="row align-items-center"> 
            <div class="col-12 breadcrumb breadcrumb-style-01 fs-14 alt-font">
                <ul>
                    <li><a href="{% url 'products:landing_page' %}">Inicio</a></li>
                    {% if category_slug %}
                        <li>
                            <a href="{% url 'products:product_list_by_category' category_slug %}">
                                {{ category_label }}
                            </a>
                        </li>
                    {% endif %}
                    {% if subcategory_slug %}
                        <li>
                            <a href="{% url 'products:product_list_by_subcategory' category_slug subcategory_slug %}">
                                {{ subcategory_label }}
                            </a>
                        </li>
                    {% endif %}
                    <li>{{ product.name|title }}</li>
                </ul>
            </div>
        </div>
    </div>
</section>
<!-- end breadcrumb --> 
<!-- start section -->
<section class="pt-40px pb-0">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 md-mb-40px" data-anime='{ "translate": [0, 0], "opacity": [0,1], "duration": 600, "delay": 100, "staggervalue": 150, "easing": "easeOutQuad" }'>
                <div class="row overflow-hidden position-relative">
                    <div class="col-12 position-relative product-image">
                        <div class="swiper product-image-slider" data-slider-options='{ "spaceBetween": 0, "watchOverflow": true, "navigation": { "nextEl": ".slider-product-next", "prevEl": ".slider-product-prev" }, "thumbs": { "swiper": { "el": ".product-image-thumb", "slidesPerView": "5", "spaceBetween": 15 } } }' data-swiper-thumb-click="1">
                            <div class="swiper-wrapper">
                                {% for image in product.images.all %}
                                    <div class="swiper-slide gallery-box pb-1">
                                        <a href="{{ image.image.url }}" data-group="lightbox-gallery" title="{{ product.name }}">
                                            <img class="product-image-fixed-detail" src="{{ image.image.url }}" alt="{{ product.name }}">
                                        </a>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="slider-product-next swiper-button-next"><i class="fa fa-chevron-right text-dark-gray icon-very-medium"></i></div>
                        <div class="slider-product-prev swiper-button-prev"><i class="fa fa-chevron-left text-dark-gray icon-very-medium"></i></div>
                    </div>
                    <div class="col-12 position-relative">
                        <div class="swiper-container product-image-thumb">
                            <div class="swiper-wrapper">
                                {% for image in product.images.all %}
                                    <div class="swiper-slide thumbnail-wrapper">
                                        <img src="{{ image.image.url }}" alt="{{ product.name }}">
                                    </div>
                                {% endfor %}
                            </div>
                        </div> 
                    </div>
                </div>
            </div>
            <div class="col-lg-5 product-info" data-anime='{ "translate": [0, 0], "opacity": [0,1], "duration": 600, "delay": 100, "staggervalue": 150, "easing": "easeOutQuad" }'>
                <span class="fw-500 text-dark-gray d-block">Interio</span>
                <h5 class="alt-font text-dark-gray fw-700 mb-10px">{{product.name|title}}</h5>
                <div class="d-block d-sm-flex align-items-center mb-20px">
                    <div class="me-10px xs-me-0">
                        <a href="#tab" class="section-link ls-minus-1px icon-small">
                            <i class="bi bi-star-fill text-golden-yellow"></i>
                            <i class="bi bi-star-fill text-golden-yellow"></i>
                            <i class="bi bi-star-fill text-golden-yellow"></i>
                            <i class="bi bi-star-fill text-golden-yellow"></i>
                            <i class="bi bi-star-fill text-golden-yellow"></i>
                        </a>
                    </div>
                    <a href="#tab" class="me-25px text-dark-gray fw-500 section-link xs-me-0">165 Reviews</a>
                    <div><span class="text-dark-gray fw-500">SKU: </span>{{product.sku}}</div>
                </div>
                <div class="product-price mb-10px">
                    {% if product.percentage_discount > 0 %}
                        <span class="text-dark-gray fs-28 xs-fs-24 fw-700 ls-minus-1px">
                            <del class="text-medium-gray me-10px fw-500">${{ product.price|intcomma }}</del> ${{ product.discounted_price|intcomma }}
                        </span>
                    {% else %}
                        ${{ product.price|intcomma }}
                    {% endif %}
                </div>

                <p class="text-dark">Los gastos de envío deben ser asumidos al momento de recibir el producto.</p>
                <div class="d-flex align-items-center mb-35px">
                    <label class="text-dark-gray alt-font me-15px fw-500">Talla</label>
                    <ul class="shop-size mb-0 d-flex flex-wrap gap-2">
                        {% for product in product.product_sizes %}
                            <li>
                                <input class="d-none" type="radio" id="size-{{ product.pk }}" name="size" value="{{ product.pk }}">
                                <label class="size-option" for="size-{{ product.pk }}">{{ product.size }}</label>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="d-flex align-items-center flex-column flex-sm-row mb-20px position-relative">
                    <div class="quantity me-15px xs-mb-15px order-1">
                        <button type="button" class="qty-minus">-</button>
                        <input class="qty-text" type="text" id="1" value="1" aria-label="qty-text" />
                        <button type="button" class="qty-plus">+</button>
                    </div>
                    <a href="demo-decor-store-cart.html" class="btn btn-cart btn-extra-large btn-switch-text btn-box-shadow btn-none-transform btn-dark-gray left-icon border-radius-5px me-15px xs-me-0 order-3 order-sm-2">
                        <span>
                            <span><i class="feather icon-feather-shopping-bag"></i></span>
                            <span class="btn-double-text" data-text="Agregar al carrito">Agregar al carrito</span> 
                        </span>
                    </a>
                </div>
                <div class="mb-20px h-1px w-100 bg-extra-medium-gray d-block"></div>
                <div class="row mb-15px">
                    <div class="col-12 icon-with-text-style-08">
                        <div class="feature-box feature-box-left-icon d-inline-flex align-middle">
                            <div class="feature-box-icon me-10px">  
                                <i class="feather icon-feather-truck top-8px position-relative align-middle text-dark-gray"></i>
                            </div>
                            <div class="feature-box-content">
                                <span><span class="alt-font text-dark-gray fw-500">Entrega estimada:</span> March 03 - March 07</span> 
                            </div>
                        </div>
                    </div>
                    <div class="col-12 icon-with-text-style-08 mb-10px">
                        <div class="feature-box feature-box-left-icon d-inline-flex align-middle">
                            <div class="feature-box-icon me-10px">  
                                <i class="feather icon-feather-archive top-8px position-relative align-middle text-dark-gray"></i>
                            </div>
                            <div class="feature-box-content">
                                <span><span class="alt-font text-dark-gray fw-500">Envios gratis:</span> En el área metropolitana por compras superiores a $350.000</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-very-light-gray ps-30px pe-30px pt-25px pb-25px mb-20px xs-p-25px border-radius-4px">
                    <span class="alt-font fs-15 fw-500 text-dark-gray mb-15px d-block lh-initial">Garantizamos un pago seguro y protegido</span>
                    <div>
                        <a href="#"><img src="{% static 'images/cards/visa.svg' %}" class="h-30px me-5px mb-5px" alt=""></a>
                        <a href="#"><img src="{% static 'images/cards/mastercard.svg' %}" class="h-30px me-5px mb-5px" alt=""></a>
                        <a href="#"><img src="{% static 'images/cards/american-express.svg' %}" class="h-30px me-5px mb-5px" alt=""></a>
                        <a href="#"><img src="{% static 'images/cards/diners-club.svg' %}" class="h-30px me-5px mb-5px" alt=""></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- end section -->

<section id="tab">
    <div class="container">
        <div class="row">
            <div class="col-12 tab-style-04" data-anime='{ "translate": [0, 0], "opacity": [0,1], "duration": 600, "delay": 100, "staggervalue": 150, "easing": "easeOutQuad" }'>
                <ul class="nav nav-tabs border-0 justify-content-center alt-font fs-17 fw-500">
                    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tab_five1" data-tab="review-tab">Opiniones (3)<span class="tab-border bg-dark-gray"></span></a></li>
                    <li class="nav-item"><a data-bs-toggle="tab" href="#tab_five2" class="nav-link">Descripción<span class="tab-border bg-dark-gray"></span></a></li>
                </ul>
                <div class="mb-6 h-1px w-100 bg-extra-medium-gray sm-mt-10px"></div>
                <div class="tab-content">
                    <!-- start tab content -->
                    <div class="tab-pane fade in active show" id="tab_five1">
                        {% with average_rating_int=average_rating|floatformat:0 %}
                            <div class="tab-pane fade in active show" id="tab_five1">
                                <div class="row align-items-center mb-6 sm-mb-10">
                                    
                                    <!-- Texto principal -->
                                    <div class="col-lg-4 col-md-12 col-sm-7 md-mb-30px text-center text-lg-start">
                                        <h5 class="alt-font text-dark-gray fw-600 mb-0 w-85 lg-w-100">
                                            <span class="fw-800">{{ total_reviews }}</span> personas han valorado este producto.
                                        </h5>
                                    </div>

                                    <!-- Promedio de estrellas -->
                                    <div class="col-lg-2 col-md-4 col-sm-5 text-center sm-mb-20px p-0 md-ps-15px md-pe-15px">
                                        <div class="border-radius-4px bg-very-light-gray p-30px xl-p-25px">
                                            <h2 class="mb-5px alt-font text-dark-gray fw-800">{{ average_rating|floatformat:1 }}</h2>
                                            <span class="text-golden-yellow icon-small d-block ls-minus-1px mb-5px">
                                                {% for i in "12345" %}
                                                    {% if forloop.counter <= average_rating %}
                                                        <i class="bi bi-star-fill"></i>
                                                    {% elif forloop.counter <= average_rating|add:"0.5" %}
                                                        <i class="bi bi-star-half"></i>
                                                    {% else %}
                                                        <i class="bi bi-star"></i>
                                                    {% endif %}
                                                {% endfor %}
                                            </span>
                                            <span class="ps-15px pe-15px pt-10px pb-10px lh-normal bg-dark-gray text-white fs-12 fw-600 text-uppercase border-radius-4px d-inline-block text-center">
                                                {{ total_reviews }} Opiniones
                                            </span>
                                        </div>
                                    </div>

                                    <!-- Barras de progreso -->
                                    <div class="col-9 col-lg-4 col-md-5 col-sm-8 progress-bar-style-02">
                                        <div class="ps-20px md-ps-0">
                                            <div class="text-dark-gray mb-15px fw-600">Valoración media de los clientes</div>
                                            {% for rating, value in rating_percentages.items %}
                                                <div class="progress mb-20px border-radius-6px">
                                                    <div class="progress-bar bg-green m-0" role="progressbar"
                                                        style="width: {{ rating_percentages.rating|stringformat:'d' }}%"
                                                        aria-valuenow="{{ value|stringformat:'d' }}"
                                                        aria-valuemin="0" aria-valuemax="100"
                                                        aria-label="rating-{{ rating }}">
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>

                                    <!-- Porcentaje de cada nota -->
                                    <div class="col-3 col-lg-2 col-md-3 col-sm-4 mt-45px">
                                        {% for rating in "54321" %}
                                            <div class="mb-15px lh-0 xs-lh-normal xs-mb-10px">
                                                <span class="text-golden-yellow fs-15 ls-minus-1px d-none d-sm-inline-block">
                                                    {% for star in "12345" %}
                                                        {% if star <= rating %}
                                                            <i class="bi bi-star-fill"></i>
                                                        {% else %}
                                                            <i class="feather icon-feather-star"></i>
                                                        {% endif %}
                                                    {% endfor %}
                                                </span>
                                                <span class="fs-13 text-dark-gray fw-600 ms-10px xs-ms-0">
                                                    {{ rating_percentages.rating|stringformat:"d" }}%
                                                </span>
                                            </div>
                                        {% endfor %}
                                    </div>

                                </div>
                            </div>
                        {% endwith %}

                        <div class="row g-0 mb-4 md-mb-35px">
                            {% if comments %}
                                {% for comment in comments %}
                                    <div class="col-12 border-bottom border-color-extra-medium-gray pb-40px mb-40px xs-pb-30px xs-mb-30px">
                                        <div class="d-block d-md-flex w-100 align-items-center">
                                            <div class="w-300px md-w-250px sm-w-100 sm-mb-10px text-center">
                                                <img src="https://placehold.co/200x200" class="rounded-circle w-90px mb-10px" alt="">
                                                <span class="text-dark-gray fw-600 d-block">{{comment.user.name}} {{comment.user.last_name}}</span>
                                                <div class="fs-14 lh-18">{{comment.created|date}}</div>
                                            </div>  
                                            <div class="w-100 last-paragraph-no-margin sm-ps-0 position-relative text-center text-md-start">
                                                <span class="text-golden-yellow ls-minus-1px mb-5px sm-me-10px sm-mb-0 d-inline-block d-md-block">
                                                    {% for i in "12345" %}
                                                        {% with i|add:"0" as index %}
                                                            {% if comment.rating >= index %}
                                                                <i class="bi bi-star-fill" data-value="{{ index }}"></i>
                                                            {% else %}
                                                                <i class="feather icon-feather-star" data-value="{{ index }}"></i>
                                                            {% endif %}
                                                            {% endwith %}
                                                        {% endfor %}
                                                </span>
                                                
                                                <p class="w-85 sm-w-100 sm-mt-15px">{{comment.comment}}.</p>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                                <div class="w-100 d-flex mt-3 justify-content-center" data-anime='{ "translateY": [0, 0], "opacity": [0,1], "duration": 600, "delay":100, "staggervalue": 150, "easing": "easeOutQuad" }'>
                                    {% if comments.has_other_pages %}
                                        <ul class="pagination pagination-style-01 fs-13 fw-500 mb-0">
                                            {% if comments.has_previous %}
                                                <li class="page-item">
                                                    <a class="page-link" href="?page={{ comments.previous_page_number }}"><i class="feather icon-feather-arrow-left fs-18 d-xs-none"></i>
                                                    </a>
                                                </li>
                                            {% else %}
                                                <li class="page-item">
                                                    <a class="page-link"><i class="feather icon-feather-arrow-left fs-18 d-xs-none"></i>
                                                    </a>
                                                </li>
                                            {% endif %}
                
                                            {% for i in comments.paginator.page_range %}
                                                {% if comments.number == i %}
                                                    <li class="active page-item">
                                                        <a class="page-link" href="#">{{ i }}</a>
                                                    </li>
                                                {% elif i > comments.number|add:'-3' and i < comments.number|add:'3' %}
                                                    <li class="page-item">
                                                        <a class="page-link" href="?page={{ i }}">{{ i }}</a>
                                                    </li>
                                                {% endif %}
                                            {% endfor %}
                                            {% if comments.has_next %}
                                                <li class="page-item">
                                                    <a class="page-link" href="?page={{ comments.next_page_number }}">
                                                        <i class="feather icon-feather-arrow-right fs-18 d-xs-none"></i>
                                                    </a>
                                                </li>
                                            {% else %}
                                                <li class="page-item">
                                                    <a class="page-link">
                                                        <i class="feather icon-feather-arrow-right fs-18 d-xs-none"></i>
                                                    </a>
                                                </li>
                                            {% endif %}
                                        </ul>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="row justify-content-center">
                            <div class="col-12">
                                <div class="p-7 lg-p-5 sm-p-7 bg-very-light-gray">
                                    <div class="row justify-content-center mb-30px sm-mb-10px">
                                        <div class="col-md-9 text-center">
                                            <h4 class="alt-font text-dark-gray fw-700 mb-20px">Añadir reseña</h4>
                                        </div>
                                    </div>
                        
                                    <form method="post" class="row contact-form-style-02" id="comment-form">
                                        {% csrf_token %}
                                        <!-- Calificación con estrellas -->
                                        <div class="col-md-12 mb-20px">
                                            <label class="form-label mb-15px">Tu calificación*</label>
                                            <div id="rating-stars" class="rating-stars">
                                                {% for i in "12345" %}
                                                    <i class="bi bi-star" data-value="{{ forloop.counter }}"></i>
                                                {% endfor %}
                                                </div>
                                            <input type="hidden" id="rating-input" name="rating">
                                        </div>
                                        <!-- Si el usuario no está autenticado, pedir nombre y correo -->
                                        {% if not request.user.is_authenticated %}
                                            <div class="col-lg-5 col-md-6 mb-20px">
                                                <label class="form-label mb-15px">Tu nombre*</label>
                                                <input type="text" name="name" class="form-control border-radius-4px" placeholder="Ingresa tu nombre" required>
                                            </div>
                                            <div class="col-lg-5 col-md-6 mb-20px">
                                                <label class="form-label mb-15px">Tu correo electrónico*</label>
                                                <input type="email" name="email" class="form-control border-radius-4px" placeholder="Ingresa tu correo" required>
                                            </div>
                                        {% endif %}
                        
                                        <!-- Reseña -->
                                        <div class="col-md-12 mb-20px">
                                            <label class="form-label mb-15px">Tu reseña</label>
                                            <textarea name="comment" rows="4" class="form-control border-radius-4px" placeholder="Escribe tu comentario" required></textarea>
                                        </div>
                                        <!-- Botón de enviar -->
                                        <div class="col-lg-3 text-start text-lg-end">
                                            <button type="submit" class="btn btn-base-color btn-small btn-box-shadow btn-round-edge">Enviar reseña</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end tab content -->
                    <!-- start tab content -->
                    <div class="tab-pane fade in" id="tab_five2">
                        <div class="row align-items-center justify-content-center mb-5 sm-mb-10">
                            <div class="col-xl-8 col-lg-9 md-mb-40px">
                                <div class="d-flex align-items-center mb-10px">
                                    <div class="col-auto pe-5px"><i class="bi bi-heart-fill text-red fs-14"></i></div> 
                                    <div class="col alt-font fs-15 fw-500 text-dark-gray">Consintiendo los deportistas</div>
                                </div>
                                <h4 class="alt-font text-dark-gray fw-700 mb-20px">{{product.name}}.</h4>
                                <p>{{product.description}}.</p>
                                <div>
                                    <div class="feature-box feature-box-left-icon-middle mb-10px">
                                        <div class="feature-box-icon feature-box-icon-rounded w-30px h-30px rounded-circle bg-very-light-gray me-10px">
                                            <i class="fa-solid fa-check fs-12 text-dark-gray"></i>
                                        </div>
                                        <div class="feature-box-content"> 
                                            <span class="d-block text-dark-gray fw-500">Productos de calidad.</span>
                                        </div>
                                    </div>
                                    <div class="feature-box feature-box-left-icon-middle mb-10px">
                                        <div class="feature-box-icon feature-box-icon-rounded w-30px h-30px rounded-circle bg-very-light-gray me-10px">
                                            <i class="fa-solid fa-check fs-12 text-dark-gray"></i>
                                        </div>
                                        <div class="feature-box-content"> 
                                            <span class="d-block text-dark-gray fw-500">Envío contra entrega.</span>
                                        </div>
                                    </div>
                                    <div class="feature-box feature-box-left-icon-middle mb-10px">
                                        <div class="feature-box-icon feature-box-icon-rounded w-30px h-30px rounded-circle bg-very-light-gray me-10px">
                                            <i class="fa-solid fa-check fs-12 text-dark-gray"></i>
                                        </div>
                                        <div class="feature-box-content"> 
                                            <span class="d-block text-dark-gray fw-500">Garantías.</span>
                                        </div>
                                    </div>
                                    <div class="feature-box feature-box-left-icon-middle">
                                        <div class="feature-box-icon feature-box-icon-rounded w-30px h-30px rounded-circle bg-very-light-gray me-10px">
                                            <i class="fa-solid fa-check fs-12 text-dark-gray"></i>
                                        </div>
                                        <div class="feature-box-content"> 
                                            <span class="d-block text-dark-gray fw-500">Pago contra entrega.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row justify-content-center">
                            <div class="col-auto text-center last-paragraph-no-margin">
                                <div class="d-inline-block align-middle me-10px"><i class="bi bi-patch-check-fill icon-extra-medium text-dark-gray"></i></div>
                                <div class="d-inline-block text-dark-gray text-uppercase fs-15 fw-600 ls-05px align-middle">Aseguramos tu máximo rendimiento en los escenarios deportivos.</div>
                            </div>
                        </div>
                    </div>
                    <!-- end tab content -->
                </div>
            </div>
        </div>
    </div>
</section>

{% block js %}
<script src="{% static 'js/utils.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const stars = document.querySelectorAll('#rating-stars i');
        const input = document.getElementById('rating-input');
        let selected = 0;
        function updateStars(value) {
            stars.forEach((star, index) => {
                star.classList.remove('bi-star-fill', 'bi-star');
                if (index < value) {
                star.classList.add('bi-star-fill');
                star.classList.add('selected');
                } else {
                star.classList.add('bi-star');
                }
            });
        }
        stars.forEach((star, index) => {
            const value = index + 1;
        
            star.addEventListener('mouseover', () => {
                updateStars(value);
            });
        
            star.addEventListener('mouseout', () => {
                updateStars(selected);
            });
        
            star.addEventListener('click', () => {
                selected = value;
                input.value = selected;
                updateStars(selected);
            });
        });
    });
    document.addEventListener("DOMContentLoaded", function() {
        const stars = document.querySelectorAll(".star-rating .star");
        const ratingInput = document.getElementById("rating-value");

        stars.forEach(star => {
            star.addEventListener("click", function() {
                const rating = this.getAttribute("data-value");
                ratingInput.value = rating;

                stars.forEach(s => {
                    const value = s.getAttribute("data-value");
                    s.classList.toggle("text-golden-yellow", value <= rating);
                    s.classList.toggle("text-dark-gray", value > rating);
                });
            });
        });
    });
</script>
{% endblock js %}

{% endblock %}